<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NurseBuddy Chart</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
<<<<<<< HEAD
    body {
      font-family: 'Noto Sans Thai', 'Prompt', 'Kanit', sans-serif;
      background: #f9fafb;
      color: #374151;
      margin: 0;
      padding: 0;
    }

    .header {
      background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 2rem;
      color: #1976d2;
      margin: 0;
    }

    .floating-btn {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      border: none;
      border-radius: 50%;
      width: 3.5rem;
      height: 3.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .floating-btn:hover {
      transform: scale(1.1);
    }

    .main-content {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
    }

    .card-title {
      font-size: 1.5rem;
      color: #1976d2;
      margin-bottom: 1rem;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .status-item {
      background: #e0f2fe;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .status-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #16a34a;
    }

    .status-label {
      font-size: 0.9rem;
      color: #64748b;
    }

    .btn {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn-success {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
    }

    .btn-success:hover {
      background: linear-gradient(135deg, #16a34a, #22c55e);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      max-width: 500px;
      width: 90%;
    }

    .modal-title {
      font-size: 1.5rem;
      color: #1976d2;
      margin-bottom: 1rem;
    }

    /* Removed empty ruleset for .floating-btn */

    /* Add the misplaced .floating-nav CSS here */
    .floating-nav {
      position: fixed;
      top: 16px;
      left: 0;
      width: 100vw;
      display: flex;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 9999;
      pointer-events: none;
    }
    .floating-nav .nav-btn {
      pointer-events: auto;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-size: 1.1rem;
      box-shadow: 0 2px 8px #0002;
      cursor: pointer;
      margin: 0 4px;
      font-weight: 600;
    }
    .floating-nav .logout-btn {
      background: #d32f2f;
    }
    @media (max-width: 500px) {
      .floating-nav {
        top: 8px;
        padding: 0 4px;
      }
      .floating-nav .nav-btn {
        font-size: 1rem;
        padding: 0.5rem 1rem;
      }
    }
    /* Removed orphaned CSS block that caused syntax error */
    .floating-back {
      top: 12px;
      left: 12px;
    }
    .floating-logout {
      top: 60px;
      left: 12px;
      background: linear-gradient(135deg, #fff 80%, #e0f2fe 100%);
      color: #d32f2f;
      border: 2px solid #d32f2f;
    }
    .floating-btn:active, .floating-btn:focus {
      box-shadow: 0 4px 16px rgba(14,165,233,0.18);
      outline: none;
      background: #0284c7;
    }
    .floating-btn .icon {
      font-size: 1.1em;
      margin-right: 2px;
    }
    @media (max-width: 500px) {
      .floating-back {
        top: 8px;
        left: 8px;
        font-size: 1rem;
        padding: 0.5rem 1rem;
      }
      .floating-logout {
        top: 56px;
        right: 8px;
        font-size: 1rem;
        padding: 0.5rem 1rem;
      }
    }
=======
>>>>>>> 336ea0ac92c2c687bc7f85bb95c4698d2338766d
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #fdf2f8, #fce7f3);
      min-height: 100vh;
      color: #374151;
      overflow-x: hidden;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Header ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
    .header {
      background: linear-gradient(135deg, #ec4899, #be185d);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(236, 72, 153, 0.3);
      position: relative;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .header .subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Navigation Buttons */
    .nav-buttons {
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .nav-btn.logout {
      background: rgba(220, 38, 38, 0.2);
      border-color: rgba(220, 38, 38, 0.3);
    }

    /* Main Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Card Style */
    .card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(236, 72, 153, 0.1);
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: #be185d;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 15px;
      border-bottom: 2px solid #fce7f3;
    }

    /* Patient Info */
    .patient-info {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border-left: 5px solid #22c55e;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
    }

    .patient-info h3 {
      color: #166534;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .patient-detail {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(22, 101, 52, 0.1);
    }

    .detail-label {
      font-weight: 600;
      color: #166534;
    }

    .detail-value {
      font-weight: 700;
      color: #059669;
    }

    /* Flow Rate Display */
    .flow-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }

    .flow-card {
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      border: 2px solid #3b82f6;
    }

    .flow-card.current {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-color: #f59e0b;
    }

    .flow-value {
      font-size: 36px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .flow-card .flow-value {
      color: #1d4ed8;
    }

    .flow-card.current .flow-value {
      color: #d97706;
    }

    .flow-label {
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* IV Calculator */
    .iv-calculator {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      padding: 25px;
      border-radius: 15px;
      border: 2px solid #64748b;
      margin-bottom: 25px;
    }

    .calc-inputs {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-group label {
      font-weight: 600;
      color: #475569;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .input-group input,
    .input-group select {
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .input-group input:focus,
    .input-group select:focus {
      border-color: #ec4899;
      outline: none;
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }

    /* Results Display */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .result-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      border-left: 4px solid #ec4899;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .result-value {
      font-size: 24px;
      font-weight: 700;
      color: #be185d;
      margin-bottom: 5px;
    }

    .result-label {
      font-size: 12px;
      color: #64748b;
      font-weight: 500;
    }

    /* Action Buttons */
    .action-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 25px 0;
    }

    .action-btn {
      background: linear-gradient(135deg, #ec4899, #be185d);
      color: white;
      border: none;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
    }

    .action-btn.secondary {
      background: linear-gradient(135deg, #64748b, #475569);
      box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
    }

    .action-btn.success {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
    }

    /* Chart Container */
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      border: 2px solid #f3e8ff;
      height: 350px;
    }

    /* Notes Section */
    .notes-section {
      background: white;
      padding: 25px;
      border-radius: 15px;
      border: 2px solid #fce7f3;
    }

    .note-input {
      width: 100%;
      padding: 15px;
      border: 2px solid #f3e8ff;
      border-radius: 10px;
      resize: vertical;
      min-height: 100px;
      margin-bottom: 15px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .note-input:focus {
      border-color: #ec4899;
      outline: none;
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }

    .note-item {
      background: #fefefe;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 12px;
      border-left: 4px solid #ec4899;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .note-author {
      font-size: 12px;
      font-weight: 600;
      color: #be185d;
    }

    .note-time {
      font-size: 11px;
      color: #64748b;
    }

    .note-content {
      font-size: 14px;
      color: #374151;
      line-height: 1.5;
    }

    /* Modals */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #be185d;
      margin-bottom: 20px;
      text-align: center;
    }

    .modal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .modal-section h4 {
      color: #374151;
      margin-bottom: 15px;
      font-size: 16px;
      font-weight: 600;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ec4899, #be185d);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #64748b, #475569);
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 0;
        margin: 0;
      }

      .container {
        padding: 10px;
        margin: 0;
        max-width: 100%;
        width: 100vw;
      }

      .header {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
      }

      .patient-info {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }

      .action-section {
        flex-direction: column;
        gap: 10px;
        margin: 15px 0;
      }

      .action-btn {
        width: 100%;
        padding: 15px;
        font-size: 16px;
        touch-action: manipulation;
      }

      .card {
        margin: 10px 0;
        border-radius: 12px;
      }

      .chart-container {
        height: 250px;
        margin: 10px 0;
      }

      .notes-section {
        padding: 15px;
      }

      .note-input {
        font-size: 16px;
        padding: 15px;
      }

      /* Fix scrolling issues */
      .modal {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .stat-card {
        padding: 15px;
      }

      .stat-value {
        font-size: 24px;
      }

      .stat-label {
        font-size: 12px;
      }

      .chart-container {
        height: 200px;
      }
    }

    /* Improve touch targets */
    button, .action-btn {
      min-height: 44px;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Fix iOS scroll issues */
    * {
      -webkit-overflow-scrolling: touch;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="nav-buttons">
      <button class="nav-btn" onclick="window.location.href='dashboard.html'">
        ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
      </button>
      <button class="nav-btn logout" onclick="logout()">
        ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
      </button>
    </div>
    <h1 id="bedTitle">üè• ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà 1</h1>
    <div class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</div>
  </div>

  <div class="container">
    <!-- Patient Information -->
    <div id="patientInfo" class="patient-info" style="display: none;">
      <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h3>
      <div class="patient-detail">
        <div class="detail-item">
          <span class="detail-label">‡∏£‡∏´‡∏±‡∏™:</span>
          <span class="detail-value" id="patientId">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">‡∏ä‡∏∑‡πà‡∏≠:</span>
          <span class="detail-value" id="patientName">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">‡∏≠‡∏≤‡∏¢‡∏∏:</span>
          <span class="detail-value" id="patientAge">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å:</span>
          <span class="detail-value" id="patientWeight">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">‡∏¢‡∏≤:</span>
          <span class="detail-value" id="medication">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì:</span>
          <span class="detail-value" id="volume">-</span>
        </div>
      </div>
    </div>

    <!-- Flow Rate Section -->
    <div class="flow-section">
      <div class="flow-card current">
        <div class="flow-value" id="currentFlow">0</div>
        <div class="flow-label">‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏î‡∏£‡∏≠‡∏õ/‡∏ô‡∏≤‡∏ó‡∏µ)</div>
      </div>
      <div class="flow-card">
        <div class="flow-value" id="orderedFlow">0</div>
        <div class="flow-label">‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á (‡∏î‡∏£‡∏≠‡∏õ/‡∏ô‡∏≤‡∏ó‡∏µ)</div>
      </div>
    </div>

    <!-- IV Calculator -->
    <div class="card">
      <div class="card-title">
        üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡∏•‡∏∑‡∏≠
      </div>

<<<<<<< HEAD
      <div id="patientInfo" class="patient-info" style="display: none;">
        <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h3>
  <div class="modal-title" style="font-family: 'Noto Sans Thai', 'Prompt', 'Sarabun', 'Kanit', sans-serif; font-size: 1.7rem; color: #1976d2; font-weight: 700; margin-bottom: 1.5rem; letter-spacing: 0.5px;">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</div>
  <form id="patientForm" autocomplete="on" style="font-family: 'Noto Sans Thai', 'Prompt', 'Sarabun', 'Kanit', sans-serif;">
    <div class="modal-content mobile-friendly" style="max-width:420px;margin:auto;padding:2rem 1.2rem;background:linear-gradient(135deg,#e0f2fe,#f0f9ff);border-radius:22px;box-shadow:0 8px 32px #1976d220;">
      <div class="modal-title" style="font-family:'Noto Sans Thai','Prompt','Sarabun','Kanit',sans-serif;font-size:1.7rem;color:#1976d2;font-weight:700;margin-bottom:1.5rem;letter-spacing:0.5px;">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</div>
      <form id="patientForm" autocomplete="on" style="font-family:'Noto Sans Thai','Prompt','Sarabun','Kanit',sans-serif;">
        ...existing code for patient fields and actions...
      </form>
      <div style="margin-top:2.5rem;text-align:center;">
        <button class="btn btn-success" id="addNewPatientBtn" style="padding:1rem 2.2rem;font-size:1.18rem;border-radius:14px;background:linear-gradient(135deg,#22c55e,#16a34a);color:white;box-shadow:0 2px 8px rgba(34,197,94,0.13);">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡∏°‡πà</button>
      </div>
    </div>
                </div>
                <div class="result-card">
                  <div class="result-icon">‚è∞</div>
                  <div class="result-content">
                    <div class="result-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏´‡∏°‡∏î</div>
                    <div class="result-value" id="finishTime">0 ‡∏ä‡∏°. 0 ‡∏ô‡∏≤‡∏ó‡∏µ</div>
                  </div>
                </div>
                <div class="result-card">
                  <div class="result-icon">üíß</div>
                  <div class="result-content">
                    <div class="result-label">‡∏´‡∏¢‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
                    <div class="result-value" id="dropPerSec">0 ‡∏î‡∏£‡∏≠‡∏õ/‡∏ß‡∏¥</div>
                  </div>
                </div>
                <div class="result-card estimated-finish">
                  <div class="result-icon">üïê</div>
                  <div class="result-content">
                    <div class="result-label">‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤</div>
                    <div class="result-value" id="estimatedFinish">-</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Time Tracking Display -->
            <div id="timeTrackingDisplay" class="time-tracking-live">
              <div class="tracking-header">
                <h4>‚è∞ ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h4>
                <div class="status-indicator" id="trackingStatus">
                  <div class="status-dot"></div>
                  <span>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
                </div>
              </div>
              <div id="timeTrackingContent" class="tracking-content">
                <div class="tracking-message">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤</div>
              </div>
            </div>
          </div>

      <div id="alertsSection" class="alerts-section">
        <h3>üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
        <div id="alertsList">
          <!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>
=======
      <div class="iv-calculator">
        <div class="calc-inputs">
          <div class="input-group">
            <label>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡∏•‡∏∑‡∏≠ (mL):</label>
            <input type="number" id="autoVolume" placeholder="1000" min="1" oninput="calculateAutoIV()">
          </div>
          <div class="input-group">
            <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏î (‡∏î‡∏£‡∏≠‡∏õ/‡∏ô‡∏≤‡∏ó‡∏µ):</label>
            <input type="number" id="autoRate" placeholder="30" min="1" oninput="calculateAutoIV()">
          </div>
          <div class="input-group">
            <label>Drop Factor:</label>
            <select id="autoDropFactor" onchange="calculateAutoIV()">
              <option value="10">10 ‡∏´‡∏¢‡∏î/cc (‡πÄ‡∏î‡πá‡∏Å)</option>
              <option value="15">15 ‡∏´‡∏¢‡∏î/cc</option>
              <option value="20" selected>20 ‡∏´‡∏¢‡∏î/cc (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)</option>
              <option value="60">60 ‡∏´‡∏¢‡∏î/cc (Micro set)</option>
            </select>
          </div>
        </div>

        <div class="results-grid">
          <div class="result-card">
            <div class="result-value" id="flowRate">0</div>
            <div class="result-label">cc/hr</div>
          </div>
          <div class="result-card">
            <div class="result-value" id="finishTime">0</div>
            <div class="result-label">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á:‡∏ô‡∏≤‡∏ó‡∏µ</div>
          </div>
          <div class="result-card">
            <div class="result-value" id="dropPerSec">0</div>
            <div class="result-label">‡∏î‡∏£‡∏≠‡∏õ/‡∏ß‡∏¥</div>
          </div>
          <div class="result-card">
            <div class="result-value" id="estimatedFinish">-</div>
            <div class="result-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏´‡∏°‡∏î</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-section">
      <button class="action-btn" onclick="openPatientModal(bedId)">
        üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
      </button>
      <button class="action-btn secondary" onclick="showIOModal()">
        üíß ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å I/O
      </button>
      <button class="action-btn success" onclick="showVitalModal()">
        ü©∫ Vital Signs
      </button>
    </div>

    <!-- Chart -->
    <div class="card">
      <div class="card-title">
        üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•
>>>>>>> 336ea0ac92c2c687bc7f85bb95c4698d2338766d
      </div>
      <div class="chart-container">
        <canvas id="flowChart"></canvas>
      </div>
    </div>

    <!-- Notes -->
    <div class="card">
      <div class="card-title">
        üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•
      </div>
      <div class="notes-section">
        <textarea class="note-input" id="noteInput" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢..."></textarea>
        <button class="action-btn success" onclick="addNote()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <div id="notesList">
          <div style="text-align: center; padding: 20px; color: #64748b; font-style: italic;">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- I/O Modal -->
  <div class="modal" id="ioModal">
    <div class="modal-content">
      <div class="modal-title">üíß ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Input/Output</div>
      <div class="modal-grid">
        <div class="modal-section">
          <h4 style="color: #22c55e;">üì• INPUT</h4>
          <div class="input-group">
            <label>‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏° (mL):</label>
            <input type="number" id="inputWater" placeholder="0">
          </div>
          <div class="input-group">
            <label>‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏´‡∏•‡∏ß (mL):</label>
            <input type="number" id="inputFood" placeholder="0">
          </div>
          <div class="input-group">
            <label>‡∏ô‡πâ‡∏≥‡πÄ‡∏Å‡∏•‡∏∑‡∏≠ IV (mL):</label>
            <input type="number" id="inputIV" placeholder="0">
          </div>
          <div class="input-group">
            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏î (mL):</label>
            <input type="number" id="inputBlood" placeholder="0">
          </div>
        </div>
        <div class="modal-section">
          <h4 style="color: #ef4444;">üì§ OUTPUT</h4>
          <div class="input-group">
            <label>‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ (mL):</label>
            <input type="number" id="outputUrine" placeholder="0">
          </div>
          <div class="input-group">
            <label>‡∏≠‡∏≤‡πÄ‡∏à‡∏µ‡∏¢‡∏ô (mL):</label>
            <input type="number" id="outputVomit" placeholder="0">
          </div>
          <div class="input-group">
            <label>Drain (mL):</label>
            <input type="number" id="outputDrain" placeholder="0">
          </div>
          <div class="input-group">
            <label>‡∏≠‡∏∏‡∏à‡∏à‡∏≤‡∏£‡∏∞‡πÄ‡∏´‡∏•‡∏ß (mL):</label>
            <input type="number" id="outputStool" placeholder="0">
          </div>
        </div>
      </div>
      <div id="ioResult" style="display: none; margin: 20px 0; padding: 15px; background: #f0f9ff; border-radius: 10px;"></div>
      <div style="text-align: center;">
        <button class="btn btn-primary" onclick="calculateIO()">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
        <button class="btn btn-success" onclick="saveIOData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="btn btn-secondary" onclick="closeModal('ioModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <!-- Vital Signs Modal -->
  <div class="modal" id="vitalModal">
    <div class="modal-content">
      <div class="modal-title">ü©∫ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Vital Signs</div>
      <div class="input-group">
        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï (Systolic/Diastolic):</label>
        <input type="text" id="bloodPressure" placeholder="120/80">
      </div>
      <div class="input-group">
        <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à (bpm):</label>
        <input type="number" id="heartRateInput" placeholder="72">
      </div>
      <div class="input-group">
        <label>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C):</label>
        <input type="number" id="temperatureInput" placeholder="36.5" step="0.1">
      </div>
      <div class="input-group">
        <label>‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î (%):</label>
        <input type="number" id="oxygenInput" placeholder="98">
      </div>
      <div style="text-align: center;">
        <button class="btn btn-success" onclick="saveVitalSigns()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="btn btn-secondary" onclick="closeModal('vitalModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <script>

    let bedId = 1;
    let currentUser = null;
    let chartInstance = null;

    // Missing functions
    function stopTimeTracking() {
      if (window.trackingInterval) {
        clearInterval(window.trackingInterval);
        window.trackingInterval = null;
        console.log('‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤');
      }
    }

    function toggleExtraActions() {
      const extraActions = document.querySelector('.extra-actions');
      if (extraActions) {
        const isVisible = extraActions.style.display !== 'none';
        extraActions.style.display = isVisible ? 'none' : 'block';
      }
    }

    function showIOModal() {
      // Create I/O Modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
      `;

      modal.innerHTML = `
        <div style="
          background: white;
          padding: 30px;
          border-radius: 20px;
          width: 90%;
          max-width: 500px;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        ">
          <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
          ">
            <h3 style="margin: 0; color: #1e293b; font-size: 20px;">üíß ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Input/Output</h3>
            <button onclick="this.closest('.modal').remove()" style="
              background: #ef4444;
              color: white;
              border: none;
              padding: 8px 12px;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
            ">‚úï</button>
          </div>

          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">üíß Input (cc)</label>
            <input type="number" id="inputValue" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤" style="
              width: 100%;
              padding: 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 16px;
            ">
          </div>

          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">üöΩ Output (cc)</label>
            <input type="number" id="outputValue" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å" style="
              width: 100%;
              padding: 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 16px;
            ">
          </div>

          <div style="margin-bottom: 25px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
            <textarea id="ioNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" rows="3" style="
              width: 100%;
              padding: 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 16px;
              resize: vertical;
            "></textarea>
          </div>

          <div style="display: flex; gap: 10px;">
            <button onclick="this.closest('.modal').remove()" style="
              flex: 1;
              padding: 12px;
              background: #64748b;
              color: white;
              border: none```python
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
            ">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button onclick="saveIORecord(); this.closest('.modal').remove();" style="
              flex: 1;
              padding: 12px;
              background: #0ea5e9;
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
            ">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);

      // Focus on first input
      setTimeout(() => {
        document.getElementById('inputValue').focus();
      }, 100);
    }

    function saveIORecord() {
      const inputValue = document.getElementById('inputValue').value;
      const outputValue = document.getElementById('outputValue').value;
      const note = document.getElementById('ioNote').value;

      if (!inputValue && !outputValue) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Input ‡∏´‡∏£‡∏∑‡∏≠ Output');
        return;
      }

      const ioRecords = JSON.parse(localStorage.getItem(`ioRecords_${bedId}`) || '[]');
      ioRecords.unshift({
        input: inputValue || 0,
        output: outputValue || 0,
        note: note,
        time: new Date().toLocaleString('th-TH'),
        author: currentUser.fullname
      });

      localStorage.setItem(`ioRecords_${bedId}`, JSON.stringify(ioRecords));

      // Add to notes
      const notes = JSON.parse(localStorage.getItem(`nurseNotes_${bedId}`) || '[]');
      notes.unshift({
        content: `üíß I/O: ‡πÄ‡∏Ç‡πâ‡∏≤ ${inputValue || 0} cc, ‡∏≠‡∏≠‡∏Å ${outputValue || 0} cc ${note ? '(' + note + ')' : ''}`,
        time: new Date().toLocaleString('th-TH'),
        author: currentUser.fullname,
        type: 'io'
      });
      localStorage.setItem(`nurseNotes_${bedId}`, JSON.stringify(notes));

      loadNotes();
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å I/O ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    function showVitalModal() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
      `;

      modal.innerHTML = `
        <div style="
          background: white;
          padding: 30px;
          border-radius: 20px;
          width: 90%;
          max-width: 500px;
          max-height: 85vh;
          overflow-y: auto;
          box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        ">
          <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
          ">
            <h3 style="margin: 0; color: #1e293b; font-size: 20px;">ü©∫ Vital Signs</h3>
            <button onclick="this.closest('.modal').remove()" style="
              background: #ef4444;
              color: white;
              border: none;
              padding: 8px 12px;
              border-radius: 8px;
              cursor: pointer;
              font-size: 16px;
            ">‚úï</button>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">ü´Ä ‡∏ä‡∏µ‡∏û‡∏à‡∏£</label>
              <input type="number" id="pulse" placeholder="bpm" style="
                width: 100%;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
              ">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</label>
              <input type="number" id="temp" placeholder="¬∞C" step="0.1" style="
                width: 100%;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
              ">
            </div>
          </div>

          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">ü©∏ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <input type="number" id="bpSys" placeholder="Systolic" style="
                width: 100%;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
              ">
              <input type="number" id="bpDia" placeholder="Diastolic" style="
                width: 100%;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
              ">
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">ü´Å ‡∏´‡∏≤‡∏¢‡πÉ‡∏à</label>
              <input type="number" id="resp" placeholder="/min" style="
                width: 100%;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
              ">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">ü©∏ O2 sat</label>
              <input type="number" id="o2sat" placeholder="%" min="0" max="100" style="
                width: 100%;
                padding: 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 16px;
              ">
            </div>
          </div>

          <div style="margin-bottom: 25px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
            <textarea id="vitalNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" rows="3" style="
              width: 100%;
              padding: 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 16px;
              resize: vertical;
            "></textarea>
          </div>

          <div style="display: flex; gap: 10px;">
            <button onclick="this.closest('.modal').remove()" style="
              flex: 1;
              padding: 12px;
              background: #64748b;
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
            ">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button onclick="saveVitalSigns(); this.closest('.modal').remove();" style="
              flex: 1;
              padding: 12px;
              background: #22c55e;
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
            ">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);

      setTimeout(() => {
        document.getElementById('pulse').focus();
      }, 100);
    }

    function saveVitalSigns() {
      const pulse = document.getElementById('pulse').value;
      const temp = document.getElementById('temp').value;
      const bpSys = document.getElementById('bpSys').value;
      const bpDia = document.getElementById('bpDia').value;
      const resp = document.getElementById('resp').value;
      const o2sat = document.getElementById('o2sat').value;
      const note = document.getElementById('vitalNote').value;

      if (!pulse && !temp && !bpSys && !bpDia && !resp && !o2sat) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Vital Signs ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
        return;
      }

      const vitalRecords = JSON.parse(localStorage.getItem(`vitalRecords_${bedId}`) || '[]');
      const vitalData = {
        pulse: pulse || '',
        temp: temp || '',
        bp_sys: bpSys || '',
        bp_dia: bpDia || '',
        resp: resp || '',
        o2sat: o2sat || '',
        note: note,
        time: new Date().toLocaleString('th-TH'),
        author: currentUser.fullname
      };

      vitalRecords.unshift(vitalData);
      localStorage.setItem(`vitalRecords_${bedId}`, JSON.stringify(vitalRecords));

      // Create vital summary
      let vitalSummary = 'ü©∫ Vital Signs: ';
      const vitals = [];
      if (pulse) vitals.push(`‡∏ä‡∏µ‡∏û‡∏à‡∏£ ${pulse} bpm`);
      if (temp) vitals.push(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ ${temp}¬∞C`);
      if (bpSys && bpDia) vitals.push(`BP ${bpSys}/${bpDia} mmHg`);
      if (resp) vitals.push(`‡∏´‡∏≤‡∏¢‡πÉ‡∏à ${resp}/min`);
      if (o2sat) vitals.push(`O2sat ${o2sat}%`);

      vitalSummary += vitals.join(', ');
      if (note) vitalSummary += ` (${note})`;

      // Add to notes
      const notes = JSON.parse(localStorage.getItem(`nurseNotes_${bedId}`) || '[]');
      notes.unshift({
        content: vitalSummary,
        time: new Date().toLocaleString('th-TH'),
        author: currentUser.fullname,
        type: 'vital'
      });
      localStorage.setItem(`nurseNotes_${bedId}`, JSON.stringify(notes));

      loadNotes();
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Vital Signs ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    document.addEventListener('DOMContentLoaded', function() {
      initializePage();
    });

    function initializePage() {
      currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
      if (!currentUser) {
        window.location.href = 'index.html';
        return;
      }

      const urlParams = new URLSearchParams(window.location.search);
      bedId = urlParams.get('bed') || 1;
      document.title = `NurseBuddy | ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà ${bedId}`;
      document.getElementById('bedTitle').textContent = `üè• ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà ${bedId}`;

      loadPatientData();
      loadNotes();
      initChart();
      updateStatus();

      setInterval(updateStatus, 10000);
    }

    function loadPatientData() {
      const patientData = JSON.parse(localStorage.getItem(`ir_data_bed_${bedId}`) || 'null');

      if (patientData) {
        document.getElementById('patientInfo').style.display = 'block';
        document.getElementById('patientId').textContent = patientData.patient_id;
        document.getElementById('patientName').textContent = patientData.name || '-';
        document.getElementById('patientAge').textContent = patientData.age || '-';
        document.getElementById('patientWeight').textContent = patientData.weight || '-';
        document.getElementById('medication').textContent = patientData.medication;
        document.getElementById('volume').textContent = patientData.volume;
        document.getElementById('orderedFlow').textContent = patientData.rate;

        populateIVCalculator(patientData);
      } else {
        document.getElementById('patientInfo').style.display = 'none';
        document.getElementById('orderedFlow').textContent = '0';
        clearIVCalculator();
      }
    }

    function populateIVCalculator(patientData) {
      const volumeMatch = patientData.volume.match(/\d+/);
      const volume = volumeMatch ? parseInt(volumeMatch[0]) : 0;

      document.getElementById('autoVolume').value = volume;
      document.getElementById('autoRate').value = patientData.rate;

      calculateAutoIV();
    }

    function clearIVCalculator() {
      document.getElementById('autoVolume').value = '';
      document.getElementById('autoRate').value = '';

      document.getElementById('flowRate').textContent = '0';
      document.getElementById('finishTime').textContent = '0';
      document.getElementById('dropPerSec').textContent = '0';
      document.getElementById('estimatedFinish').textContent = '-';
    }

    function calculateAutoIV() {
      const volume = parseFloat(document.getElementById('autoVolume').value) || 0;
      const rate = parseFloat(document.getElementById('autoRate').value) || 0;
      const dropFactor = parseFloat(document.getElementById('autoDropFactor').value) || 20;

      if (!volume || !rate) {
        document.getElementById('flowRate').textContent = '0';
        document.getElementById('finishTime').textContent = '0';
        document.getElementById('dropPerSec').textContent = '0';
        document.getElementById('estimatedFinish').textContent = '-';
        return;
      }

      const ccPerHr = (rate * 60) / dropFactor;
      const timeHours = volume / ccPerHr;
      const hours = Math.floor(timeHours);
      const minutes = Math.round((timeHours - hours) * 60);
      const dropPerSec = rate / 60;

      const startTime = new Date();
      const finishTime = new Date(startTime.getTime() + (timeHours * 60 * 60 * 1000));
      const estimatedFinish = finishTime.toLocaleString('th-TH', {
        weekday: 'short',
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });

      document.getElementById('flowRate').textContent = ccPerHr.toFixed(1);
      document.getElementById('finishTime').textContent = `${hours}:${minutes.toString().padStart(2, '0')}`;
      document.getElementById('dropPerSec').textContent = dropPerSec.toFixed(1);
      document.getElementById('estimatedFinish').textContent = estimatedFinish;
    }

    function updateStatus() {
      const patientData = JSON.parse(localStorage.getItem(`ir_data_bed_${bedId}`) || 'null');

      let currentFlow;
      if (patientData && patientData.rate) {
        const baseRate = patientData.rate;
        const variation = Math.floor(Math.random() * 6) - 3;
        currentFlow = Math.max(0, baseRate + variation);
      } else {
        currentFlow = Math.floor(Math.random() * 10) + 15;
      }

      document.getElementById('currentFlow').textContent = currentFlow;

      if (chartInstance) {
        const now = new Date();
        const timeLabel = now.getHours().toString().padStart(2, '0') + ':' + 
                         now.getMinutes().toString().padStart(2, '0');

        chartInstance.data.labels.push(timeLabel);
        chartInstance.data.datasets[0].data.push(currentFlow);

        if (chartInstance.data.labels.length > 12) {
          chartInstance.data.labels.shift();
          chartInstance.data.datasets[0].data.shift();
        }

        chartInstance.update();
      }
    }

    function initChart() {
      const ctx = document.getElementById('flowChart').getContext('2d');
      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏• (‡∏î‡∏£‡∏≠‡∏õ/‡∏ô‡∏≤‡∏ó‡∏µ)',
            data: [],
            borderColor: '#ec4899',
            backgroundColor: 'rgba(236, 72, 153, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(236, 72, 153, 0.1)'
              }
            },
            x: {
              grid: {
                color: 'rgba(236, 72, 153, 0.1)'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      clearModalInputs(modalId);
    }

    function clearModalInputs(modalId) {
      const modal = document.getElementById(modalId);
      modal.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
        input.value = '';
      });
    }

    function calculateIO() {
      const inputWater = parseInt(document.getElementById('inputWater').value) || 0;
      const inputFood = parseInt(document.getElementById('inputFood').value) || 0;
      const inputIV = parseInt(document.getElementById('inputIV').value) || 0;
      const inputBlood = parseInt(document.getElementById('inputBlood').value) || 0;

      const outputUrine = parseInt(document.getElementById('outputUrine').value) || 0;
      const outputVomit = parseInt(document.getElementById('outputVomit').value) || 0;
      const outputDrain = parseInt(document.getElementById('outputDrain').value) || 0;
      const outputStool = parseInt(document.getElementById('outputStool').value) || 0;

      const totalIn = inputWater + inputFood + inputIV + inputBlood;
      const totalOut = outputUrine + outputVomit + outputDrain + outputStool;
      const balance = totalIn - totalOut;

      const result = document.getElementById('ioResult');
      result.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 14px;">
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: 700; color: #22c55e;">${totalIn}</div>
            <div style="font-size: 12px; color: #166534;">INPUT ‡∏£‡∏ß‡∏° (mL)</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: 700; color: #ef4444;">${totalOut}</div>
            <div style="font-size: 12px; color: #991b1b;">OUTPUT ‡∏£‡∏ß‡∏° (mL)</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: 700; color: ${balance >= 0 ? '#22c55e' : '#ef4444'};">
              ${balance > 0 ? '+' : ''}${balance}
            </div>
            <div style="font-size: 12px; color: #64748b;">BALANCE (mL)</div>
          </div>
        </div>
      `;
      result.style.display = 'block';
    }

    function saveIOData() {
      calculateIO();
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å I/O ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      closeModal('ioModal');
    }

    function saveVitalSigns() {
      const bloodPressure = document.getElementById('bloodPressure').value;
      const heartRate = document.getElementById('heartRateInput').value;
      const temperature = document.getElementById('temperatureInput').value;
      const oxygen = document.getElementById('oxygenInput').value;

      if (!bloodPressure || !heartRate || !temperature) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        return;
      }

      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Vital Signs ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      closeModal('vitalModal');
    }

    function addNote() {
      const content = document.getElementById('noteInput').value.trim();
      if (!content) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
        return;
      }

      const notes = JSON.parse(localStorage.getItem(`nurseNotes_${bedId}`) || '[]');
      notes.unshift({
        content: content,
        time: new Date().toLocaleString('th-TH'),
        author: currentUser.fullname,
        type: 'general'
      });
      localStorage.setItem(`nurseNotes_${bedId}`, JSON.stringify(notes));

      document.getElementById('noteInput').value = '';
      loadNotes();
    }

    function loadNotes() {
      const notes = JSON.parse(localStorage.getItem(`nurseNotes_${bedId}`) || '[]');
      const notesList = document.getElementById('notesList');

      if (notes.length === 0) {
        notesList.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b; font-style: italic;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>';
        return;
      }

      notesList.innerHTML = notes.slice(0, 10).map(note => `
        <div class="note-item">
          <div class="note-header">
            <div class="note-author">üë§ ${note.author}</div>
            <div class="note-time">${note.time}</div>
          </div>
          <div class="note-content">${note.content}</div>
        </div>
      `).join('');
    }

    function openPatientModal(bedId) {
      // ‡πÄ‡∏õ‡∏¥‡∏î patient modal (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ patient-modal.js)
      if (typeof openPatientModal !== 'undefined') {
        openPatientModal(bedId);
      } else {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard');
      }
    }

    function logout() {
      if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
        sessionStorage.removeItem('currentUser');
        window.location.href = 'index.html';
      }
    }

    // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    });

    // ‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    document.getElementById('noteInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && e.ctrlKey) {
        addNote();
      }
    });
  </script>

  <script src="System/data-manager.js"></script>
  <script src="System/patient-modal.js"></script>
  <script>
    window.addEventListener('patientSaved', e => {
      loadPatientData();
      loadNotes();
    });
  </script>
</body>
</html>